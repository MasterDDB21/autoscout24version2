!function n(r,s,i){function a(t,e){if(!s[t]){if(!r[t]){var o="function"==typeof require&&require;if(!e&&o)return o(t,!0);if(c)return c(t,!0);throw(o=new Error("Cannot find module '"+t+"'")).code="MODULE_NOT_FOUND",o}o=s[t]={exports:{}},r[t][0].call(o.exports,function(e){return a(r[t][1][e]||e)},o,o.exports,n,r,s,i)}return s[t].exports}for(var c="function"==typeof require&&require,e=0;e<i.length;e++)a(i[e]);return a}({1:[function(e,t,o){"use strict";Object.defineProperty(o,"__esModule",{value:!0});var n=(r.prototype.abort=function(){this.isAborted||(this.isAborted=!0,this.onabort&&this.onabort())},Object.defineProperty(r.prototype,"signal",{get:function(){return this},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"aborted",{get:function(){return this.isAborted},enumerable:!0,configurable:!0}),r);function r(){this.isAborted=!1}o.AbortController=n},{}],2:[function(e,t,o){"use strict";var n,r=this&&this.__extends||(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])},function(e,t){function o(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)});Object.defineProperty(o,"__esModule",{value:!0});var s,i=(s=Error,r(a,s),a);function a(e,t){var o=this,n=this.constructor.prototype;return(o=s.call(this,e)||this).statusCode=t,o.__proto__=n,o}o.HttpError=i;var c,r=(c=Error,r(l,c),l);function l(e){var t=this,o=this.constructor.prototype;return(t=c.call(this,e=void 0===e?"A timeout occurred.":e)||this).__proto__=o,t}o.TimeoutError=r},{}],3:[function(e,t,o){"use strict";Object.defineProperty(o,"__esModule",{value:!0});var s=e("./TextMessageFormat"),i=e("./Utils"),e=(n.prototype.writeHandshakeRequest=function(e){return s.TextMessageFormat.write(JSON.stringify(e))},n.prototype.parseHandshakeResponse=function(e){if(i.isArrayBuffer(e)){var t=new Uint8Array(e);if(-1===(r=t.indexOf(s.TextMessageFormat.RecordSeparatorCode)))throw new Error("Message is incomplete.");var o=r+1,n=String.fromCharCode.apply(null,t.slice(0,o)),t=t.byteLength>o?t.slice(o).buffer:null}else{var r,e=e;if(-1===(r=e.indexOf(s.TextMessageFormat.RecordSeparator)))throw new Error("Message is incomplete.");o=r+1;n=e.substring(0,o),t=e.length>o?e.substring(o):null}n=s.TextMessageFormat.parse(n);return[t,JSON.parse(n[0])]},n);function n(){}o.HandshakeProtocol=e},{"./TextMessageFormat":15,"./Utils":16}],4:[function(e,t,o){"use strict";var n,r=this&&this.__extends||(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])},function(e,t){function o(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}),s=this&&this.__assign||Object.assign||function(e){for(var t,o=1,n=arguments.length;o<n;o++)for(var r in t=arguments[o])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e};Object.defineProperty(o,"__esModule",{value:!0});var i=e("./Errors"),a=e("./ILogger"),c=function(e,t,o){this.statusCode=e,this.statusText=t,this.content=o};o.HttpResponse=c;l.prototype.get=function(e,t){return this.send(s({},t,{method:"GET",url:e}))},l.prototype.post=function(e,t){return this.send(s({},t,{method:"POST",url:e}))},l.prototype.delete=function(e,t){return this.send(s({},t,{method:"DELETE",url:e}))},e=l;function l(){}o.HttpClient=e;var u,e=(r(p,u=e),p.prototype.send=function(n){var r=this;return new Promise(function(e,t){var o=new XMLHttpRequest;o.open(n.method,n.url,!0),o.withCredentials=!0,o.setRequestHeader("X-Requested-With","XMLHttpRequest"),o.setRequestHeader("Content-Type","text/plain;charset=UTF-8"),n.headers&&Object.keys(n.headers).forEach(function(e){return o.setRequestHeader(e,n.headers[e])}),n.responseType&&(o.responseType=n.responseType),n.abortSignal&&(n.abortSignal.onabort=function(){o.abort()}),n.timeout&&(o.timeout=n.timeout),o.onload=function(){n.abortSignal&&(n.abortSignal.onabort=null),200<=o.status&&o.status<300?e(new c(o.status,o.statusText,o.response||o.responseText)):t(new i.HttpError(o.statusText,o.status))},o.onerror=function(){r.logger.log(a.LogLevel.Warning,"Error from HTTP request. "+o.status+": "+o.statusText),t(new i.HttpError(o.statusText,o.status))},o.ontimeout=function(){r.logger.log(a.LogLevel.Warning,"Timeout from HTTP request."),t(new i.TimeoutError)},o.send(n.content||"")})},p);function p(e){var t=u.call(this)||this;return t.logger=e,t}o.DefaultHttpClient=e},{"./Errors":2,"./ILogger":9}],5:[function(e,t,o){"use strict";var n=this&&this.__awaiter||function(s,i,a,c){return new(a=a||Promise)(function(e,t){function o(e){try{r(c.next(e))}catch(e){t(e)}}function n(e){try{r(c.throw(e))}catch(e){t(e)}}function r(t){t.done?e(t.value):new a(function(e){e(t.value)}).then(o,n)}r((c=c.apply(s,i||[])).next())})},u=this&&this.__generator||function(o,n){var r,s,i,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]},e={next:t(0),throw:t(1),return:t(2)};return"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function(t){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,s&&(i=2&t[0]?s.return:t[0]?s.throw||((i=s.return)&&i.call(s),0):s.next)&&!(i=i.call(s,t[1])).done)return i;switch(s=0,(t=i?[2&t[0],i.value]:t)[0]){case 0:case 1:i=t;break;case 4:return a.label++,{value:t[1],done:!1};case 5:a.label++,s=t[1],t=[0];continue;case 7:t=a.ops.pop(),a.trys.pop();continue;default:if(!(i=0<(i=a.trys).length&&i[i.length-1])&&(6===t[0]||2===t[0])){a=0;continue}if(3===t[0]&&(!i||t[1]>i[0]&&t[1]<i[3])){a.label=t[1];break}if(6===t[0]&&a.label<i[1]){a.label=i[1],i=t;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(t);break}i[2]&&a.ops.pop(),a.trys.pop();continue}t=n.call(o,a)}catch(e){t=[6,e],s=0}finally{r=i=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,e])}}};Object.defineProperty(o,"__esModule",{value:!0});var r=e("./HttpClient"),p=e("./ILogger"),h=e("./ITransport"),l=e("./LongPollingTransport"),s=e("./ServerSentEventsTransport"),i=e("./Utils"),a=e("./WebSocketTransport"),e=(c.prototype.start=function(e){return e=e||h.TransferFormat.Binary,i.Arg.isIn(e,h.TransferFormat,"transferFormat"),this.logger.log(p.LogLevel.Debug,"Starting connection with transfer format '"+h.TransferFormat[e]+"'."),2!==this.connectionState?Promise.reject(new Error("Cannot start a connection that is not in the 'Disconnected' state.")):(this.connectionState=0,this.startPromise=this.startInternal(e),this.startPromise)},c.prototype.send=function(e){if(1!==this.connectionState)throw new Error("Cannot send data if the connection is not in the 'Connected' State.");return this.transport.send(e)},c.prototype.stop=function(t){return n(this,void 0,void 0,function(){return u(this,function(e){switch(e.label){case 0:this.connectionState=2,e.label=1;case 1:return e.trys.push([1,3,,4]),[4,this.startPromise];case 2:return e.sent(),[3,4];case 3:return e.sent(),[3,4];case 4:return this.transport?(this.stopError=t,[4,this.transport.stop()]):[3,6];case 5:e.sent(),this.transport=null,e.label=6;case 6:return[2]}})})},c.prototype.startInternal=function(c){return n(this,void 0,void 0,function(){var o,n,r,t,s,i,a=this;return u(this,function(e){switch(e.label){case 0:o=this.baseUrl,this.accessTokenFactory=this.options.accessTokenFactory,e.label=1;case 1:return(e.trys.push([1,12,,13]),this.options.skipNegotiation)?this.options.transport!==h.HttpTransportType.WebSockets?[3,3]:(this.transport=this.constructTransport(h.HttpTransportType.WebSockets),[4,this.transport.connect(o,c)]):[3,5];case 2:return e.sent(),[3,4];case 3:throw Error("Negotiation can only be skipped when using the WebSocket transport directly.");case 4:return[3,11];case 5:n=null,r=0,t=function(){var t;return u(this,function(e){switch(e.label){case 0:return[4,s.getNegotiationResponse(o)];case 1:return(n=e.sent(),2===s.connectionState)?[2,{value:void 0}]:(n.url&&(o=n.url),n.accessToken&&(t=n.accessToken,s.accessTokenFactory=function(){return t}),r++,[2])}})},s=this,e.label=6;case 6:return[5,t()];case 7:if("object"==typeof(i=e.sent()))return[2,i.value];e.label=8;case 8:if(n.url&&r<100)return[3,6];e.label=9;case 9:if(100===r&&n.url)throw Error("Negotiate redirection limit exceeded.");return[4,this.createTransport(o,this.options.transport,n,c)];case 10:e.sent(),e.label=11;case 11:return this.transport instanceof l.LongPollingTransport&&(this.features.inherentKeepAlive=!0),this.transport.onreceive=this.onreceive,this.transport.onclose=function(e){return a.stopConnection(e)},this.changeState(0,1),[3,13];case 12:throw i=e.sent(),this.logger.log(p.LogLevel.Error,"Failed to start the connection: "+i),this.connectionState=2,this.transport=null,i;case 13:return[2]}})})},c.prototype.getNegotiationResponse=function(s){return n(this,void 0,void 0,function(){var t,o,n,r;return u(this,function(e){switch(e.label){case 0:return[4,this.accessTokenFactory()];case 1:(t=e.sent())&&((n={}).Authorization="Bearer "+t,o=n),n=this.resolveNegotiateUrl(s),this.logger.log(p.LogLevel.Debug,"Sending negotiation request: "+n),e.label=2;case 2:return e.trys.push([2,4,,5]),[4,this.httpClient.post(n,{content:"",headers:o})];case 3:if(200!==(r=e.sent()).statusCode)throw Error("Unexpected status code returned from negotiate "+r.statusCode);return[2,JSON.parse(r.content)];case 4:throw r=e.sent(),this.logger.log(p.LogLevel.Error,"Failed to complete negotiation with the server: "+r),r;case 5:return[2]}})})},c.prototype.createConnectUrl=function(e,t){return e+(-1===e.indexOf("?")?"?":"&")+"id="+t},c.prototype.createTransport=function(i,a,c,l){return n(this,void 0,void 0,function(){var t,o,n,r,s;return u(this,function(e){switch(e.label){case 0:return(t=this.createConnectUrl(i,c.connectionId),this.isITransport(a))?(this.logger.log(p.LogLevel.Debug,"Connection was provided an instance of ITransport, using that directly."),this.transport=a,[4,this.transport.connect(t,l)]):[3,2];case 1:return e.sent(),this.changeState(0,1),[2];case 2:n=c.availableTransports,o=0,n=n,e.label=3;case 3:return o<n.length?(s=n[o],this.connectionState=0,"number"!=typeof(r=this.resolveTransport(s,a,l))?[3,8]:(this.transport=this.constructTransport(r),null!==c.connectionId?[3,5]:[4,this.getNegotiationResponse(i)])):[3,9];case 4:c=e.sent(),t=this.createConnectUrl(i,c.connectionId),e.label=5;case 5:return e.trys.push([5,7,,8]),[4,this.transport.connect(t,l)];case 6:return e.sent(),this.changeState(0,1),[2];case 7:return s=e.sent(),this.logger.log(p.LogLevel.Error,"Failed to start the transport '"+h.HttpTransportType[r]+"': "+s),this.connectionState=2,c.connectionId=null,[3,8];case 8:return o++,[3,3];case 9:throw new Error("Unable to initialize any of the available transports.")}})})},c.prototype.constructTransport=function(e){switch(e){case h.HttpTransportType.WebSockets:return new a.WebSocketTransport(this.accessTokenFactory,this.logger,this.options.logMessageContent);case h.HttpTransportType.ServerSentEvents:return new s.ServerSentEventsTransport(this.httpClient,this.accessTokenFactory,this.logger,this.options.logMessageContent);case h.HttpTransportType.LongPolling:return new l.LongPollingTransport(this.httpClient,this.accessTokenFactory,this.logger,this.options.logMessageContent);default:throw new Error("Unknown transport: "+e+".")}},c.prototype.resolveTransport=function(e,t,o){var n=h.HttpTransportType[e.transport];if(null==n)this.logger.log(p.LogLevel.Debug,"Skipping transport '"+e.transport+"' because it is not supported by this client.");else{var r=e.transferFormats.map(function(e){return h.TransferFormat[e]});if(e=n,(t=t)&&0==(e&t))this.logger.log(p.LogLevel.Debug,"Skipping transport '"+h.HttpTransportType[n]+"' because it was disabled by the client.");else if(0<=r.indexOf(o)){if(!(n===h.HttpTransportType.WebSockets&&"undefined"==typeof WebSocket||n===h.HttpTransportType.ServerSentEvents&&"undefined"==typeof EventSource))return this.logger.log(p.LogLevel.Debug,"Selecting transport '"+h.HttpTransportType[n]+"'"),n;this.logger.log(p.LogLevel.Debug,"Skipping transport '"+h.HttpTransportType[n]+"' because it is not supported in your environment.'")}else this.logger.log(p.LogLevel.Debug,"Skipping transport '"+h.HttpTransportType[n]+"' because it does not support the requested transfer format '"+h.TransferFormat[o]+"'.")}return null},c.prototype.isITransport=function(e){return e&&"object"==typeof e&&"connect"in e},c.prototype.changeState=function(e,t){return this.connectionState===e&&(this.connectionState=t,!0)},c.prototype.stopConnection=function(t){return n(this,void 0,void 0,function(){return u(this,function(e){return this.transport=null,(t=this.stopError||t)?this.logger.log(p.LogLevel.Error,"Connection disconnected with error '"+t+"'."):this.logger.log(p.LogLevel.Information,"Connection disconnected."),this.connectionState=2,this.onclose&&this.onclose(t),[2]})})},c.prototype.resolveUrl=function(e){if(0===e.lastIndexOf("https://",0)||0===e.lastIndexOf("http://",0))return e;if("undefined"==typeof window||!window||!window.document)throw new Error("Cannot resolve '"+e+"'.");var t=window.document.createElement("a");return t.href=e,this.logger.log(p.LogLevel.Information,"Normalizing '"+e+"' to '"+t.href+"'."),t.href},c.prototype.resolveNegotiateUrl=function(e){var t=e.indexOf("?"),o=e.substring(0,-1===t?e.length:t);return"/"!==o[o.length-1]&&(o+="/"),o+="negotiate",o+=-1===t?"":e.substring(t)},c);function c(e,t){void 0===t&&(t={}),this.features={},i.Arg.isRequired(e,"url"),this.logger=i.createLogger(t.logger),this.baseUrl=this.resolveUrl(e),(t=t||{}).accessTokenFactory=t.accessTokenFactory||function(){return null},t.logMessageContent=t.logMessageContent||!1,this.httpClient=t.httpClient||new r.DefaultHttpClient(this.logger),this.connectionState=2,this.options=t}o.HttpConnection=e},{"./HttpClient":4,"./ILogger":9,"./ITransport":10,"./LongPollingTransport":13,"./ServerSentEventsTransport":14,"./Utils":16,"./WebSocketTransport":17}],6:[function(e,t,o){"use strict";var n=this&&this.__awaiter||function(s,i,a,c){return new(a=a||Promise)(function(e,t){function o(e){try{r(c.next(e))}catch(e){t(e)}}function n(e){try{r(c.throw(e))}catch(e){t(e)}}function r(t){t.done?e(t.value):new a(function(e){e(t.value)}).then(o,n)}r((c=c.apply(s,i||[])).next())})},r=this&&this.__generator||function(o,n){var r,s,i,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]},e={next:t(0),throw:t(1),return:t(2)};return"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function(t){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,s&&(i=2&t[0]?s.return:t[0]?s.throw||((i=s.return)&&i.call(s),0):s.next)&&!(i=i.call(s,t[1])).done)return i;switch(s=0,(t=i?[2&t[0],i.value]:t)[0]){case 0:case 1:i=t;break;case 4:return a.label++,{value:t[1],done:!1};case 5:a.label++,s=t[1],t=[0];continue;case 7:t=a.ops.pop(),a.trys.pop();continue;default:if(!(i=0<(i=a.trys).length&&i[i.length-1])&&(6===t[0]||2===t[0])){a=0;continue}if(3===t[0]&&(!i||t[1]>i[0]&&t[1]<i[3])){a.label=t[1];break}if(6===t[0]&&a.label<i[1]){a.label=i[1],i=t;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(t);break}i[2]&&a.ops.pop(),a.trys.pop();continue}t=n.call(o,a)}catch(e){t=[6,e],s=0}finally{r=i=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,e])}}};Object.defineProperty(o,"__esModule",{value:!0});var s=e("./HandshakeProtocol"),i=e("./IHubProtocol"),a=e("./ILogger"),c=e("./Utils"),e=(l.create=function(e,t,o){return new l(e,t,o)},l.prototype.start=function(){return n(this,void 0,void 0,function(){var t;return r(this,function(e){switch(e.label){case 0:return t={protocol:this.protocol.name,version:this.protocol.version},this.logger.log(a.LogLevel.Debug,"Starting HubConnection."),this.receivedHandshakeResponse=!1,[4,this.connection.start(this.protocol.transferFormat)];case 1:return e.sent(),this.logger.log(a.LogLevel.Debug,"Sending handshake request."),[4,this.connection.send(this.handshakeProtocol.writeHandshakeRequest(t))];case 2:return e.sent(),this.logger.log(a.LogLevel.Information,"Using HubProtocol '"+this.protocol.name+"'."),this.cleanupTimeout(),this.configureTimeout(),[2]}})})},l.prototype.stop=function(){return this.logger.log(a.LogLevel.Debug,"Stopping HubConnection."),this.cleanupTimeout(),this.connection.stop()},l.prototype.stream=function(e){for(var t=this,o=[],n=1;n<arguments.length;n++)o[n-1]=arguments[n];var r=this.createStreamInvocation(e,o),s=new c.Subject(function(){var e=t.createCancelInvocation(r.invocationId),e=t.protocol.writeMessage(e);return delete t.callbacks[r.invocationId],t.connection.send(e)});this.callbacks[r.invocationId]=function(e,t){t?s.error(t):e.type===i.MessageType.Completion?e.error?s.error(new Error(e.error)):s.complete():s.next(e.item)};e=this.protocol.writeMessage(r);return this.connection.send(e).catch(function(e){s.error(e),delete t.callbacks[r.invocationId]}),s},l.prototype.send=function(e){for(var t=[],o=1;o<arguments.length;o++)t[o-1]=arguments[o];e=this.createInvocation(e,t,!0),e=this.protocol.writeMessage(e);return this.connection.send(e)},l.prototype.invoke=function(e){for(var t=this,o=[],n=1;n<arguments.length;n++)o[n-1]=arguments[n];var r=this.createInvocation(e,o,!1);return new Promise(function(o,n){t.callbacks[r.invocationId]=function(e,t){t?n(t):e.type===i.MessageType.Completion?(t=e).error?n(new Error(t.error)):o(t.result):n(new Error("Unexpected message type: "+e.type))};var e=t.protocol.writeMessage(r);t.connection.send(e).catch(function(e){n(e),delete t.callbacks[r.invocationId]})})},l.prototype.on=function(e,t){e&&t&&(e=e.toLowerCase(),this.methods[e]||(this.methods[e]=[]),-1===this.methods[e].indexOf(t)&&this.methods[e].push(t))},l.prototype.off=function(e,t){var o;e&&(e=e.toLowerCase(),(o=this.methods[e])&&(t?-1!==(t=o.indexOf(t))&&(o.splice(t,1),0===o.length&&delete this.methods[e]):delete this.methods[e]))},l.prototype.onclose=function(e){e&&this.closedCallbacks.push(e)},l.prototype.processIncomingData=function(e){if(this.cleanupTimeout(),this.receivedHandshakeResponse||(e=this.processHandshakeResponse(e),this.receivedHandshakeResponse=!0),e)for(var t=0,o=this.protocol.parseMessages(e,this.logger);t<o.length;t++){var n=o[t];switch(n.type){case i.MessageType.Invocation:this.invokeClientMethod(n);break;case i.MessageType.StreamItem:case i.MessageType.Completion:var r=this.callbacks[n.invocationId];null!=r&&(n.type===i.MessageType.Completion&&delete this.callbacks[n.invocationId],r(n));break;case i.MessageType.Ping:break;case i.MessageType.Close:this.logger.log(a.LogLevel.Information,"Close message received from server."),this.connection.stop(n.error?new Error("Server returned an error on close: "+n.error):null);break;default:this.logger.log(a.LogLevel.Warning,"Invalid message type: "+n.type)}}this.configureTimeout()},l.prototype.processHandshakeResponse=function(e){var t,o;try{o=(r=this.handshakeProtocol.parseHandshakeResponse(e))[0],t=r[1]}catch(e){var n="Error parsing handshake response: "+e;this.logger.log(a.LogLevel.Error,n);var r=new Error(n);throw this.connection.stop(r),r}return t.error?(n="Server returned handshake error: "+t.error,this.logger.log(a.LogLevel.Error,n),this.connection.stop(new Error(n))):this.logger.log(a.LogLevel.Debug,"Server handshake complete."),o},l.prototype.configureTimeout=function(){var e=this;this.connection.features&&this.connection.features.inherentKeepAlive||(this.timeoutHandle=setTimeout(function(){return e.serverTimeout()},this.serverTimeoutInMilliseconds))},l.prototype.serverTimeout=function(){this.connection.stop(new Error("Server timeout elapsed without receiving a message from the server."))},l.prototype.invokeClientMethod=function(t){var o=this,e=this.methods[t.target.toLowerCase()];e?(e.forEach(function(e){return e.apply(o,t.arguments)}),t.invocationId&&(this.logger.log(a.LogLevel.Error,e="Server requested a response, which is not supported in this version of the client."),this.connection.stop(new Error(e)))):this.logger.log(a.LogLevel.Warning,"No client method with the name '"+t.target+"' found.")},l.prototype.connectionClosed=function(t){var o=this,n=this.callbacks;this.callbacks={},Object.keys(n).forEach(function(e){(0,n[e])(void 0,t||new Error("Invocation canceled due to connection being closed."))}),this.cleanupTimeout(),this.closedCallbacks.forEach(function(e){return e.apply(o,[t])})},l.prototype.cleanupTimeout=function(){this.timeoutHandle&&clearTimeout(this.timeoutHandle)},l.prototype.createInvocation=function(e,t,o){if(o)return{arguments:t,target:e,type:i.MessageType.Invocation};o=this.id;return this.id++,{arguments:t,invocationId:o.toString(),target:e,type:i.MessageType.Invocation}},l.prototype.createStreamInvocation=function(e,t){var o=this.id;return this.id++,{arguments:t,invocationId:o.toString(),target:e,type:i.MessageType.StreamInvocation}},l.prototype.createCancelInvocation=function(e){return{invocationId:e,type:i.MessageType.CancelInvocation}},l);function l(e,t,o){var n=this;c.Arg.isRequired(e,"connection"),c.Arg.isRequired(t,"logger"),c.Arg.isRequired(o,"protocol"),this.serverTimeoutInMilliseconds=3e4,this.logger=t,this.protocol=o,this.connection=e,this.handshakeProtocol=new s.HandshakeProtocol,this.connection.onreceive=function(e){return n.processIncomingData(e)},this.connection.onclose=function(e){return n.connectionClosed(e)},this.callbacks={},this.methods={},this.closedCallbacks=[],this.id=0}o.HubConnection=e},{"./HandshakeProtocol":3,"./IHubProtocol":8,"./ILogger":9,"./Utils":16}],7:[function(e,t,o){"use strict";Object.defineProperty(o,"__esModule",{value:!0});var n=e("./HttpConnection"),r=e("./HubConnection"),s=e("./JsonHubProtocol"),i=e("./Loggers"),a=e("./Utils"),e=(c.prototype.configureLogging=function(e){return a.Arg.isRequired(e,"logging"),void 0!==e.log?this.logger=e:this.logger=new a.ConsoleLogger(e),this},c.prototype.withUrl=function(e,t){return a.Arg.isRequired(e,"url"),this.url=e,this.httpConnectionOptions="object"==typeof t?t:{transport:t},this},c.prototype.withHubProtocol=function(e){return a.Arg.isRequired(e,"protocol"),this.protocol=e,this},c.prototype.build=function(){var e=this.httpConnectionOptions||{};if(void 0===e.logger&&(e.logger=this.logger),!this.url)throw new Error("The 'HubConnectionBuilder.withUrl' method must be called before building the connection.");e=new n.HttpConnection(this.url,e);return r.HubConnection.create(e,this.logger||i.NullLogger.instance,this.protocol||new s.JsonHubProtocol)},c);function c(){}o.HubConnectionBuilder=e},{"./HttpConnection":5,"./HubConnection":6,"./JsonHubProtocol":11,"./Loggers":12,"./Utils":16}],8:[function(e,t,o){"use strict";Object.defineProperty(o,"__esModule",{value:!0}),(o=o.MessageType||(o.MessageType={}))[o.Invocation=1]="Invocation",o[o.StreamItem=2]="StreamItem",o[o.Completion=3]="Completion",o[o.StreamInvocation=4]="StreamInvocation",o[o.CancelInvocation=5]="CancelInvocation",o[o.Ping=6]="Ping",o[o.Close=7]="Close"},{}],9:[function(e,t,o){"use strict";Object.defineProperty(o,"__esModule",{value:!0}),(o=o.LogLevel||(o.LogLevel={}))[o.Trace=0]="Trace",o[o.Debug=1]="Debug",o[o.Information=2]="Information",o[o.Warning=3]="Warning",o[o.Error=4]="Error",o[o.Critical=5]="Critical",o[o.None=6]="None"},{}],10:[function(e,t,o){"use strict";var n;Object.defineProperty(o,"__esModule",{value:!0}),(n=o.HttpTransportType||(o.HttpTransportType={}))[n.None=0]="None",n[n.WebSockets=1]="WebSockets",n[n.ServerSentEvents=2]="ServerSentEvents",n[n.LongPolling=4]="LongPolling",(o=o.TransferFormat||(o.TransferFormat={}))[o.Text=1]="Text",o[o.Binary=2]="Binary"},{}],11:[function(e,t,o){"use strict";Object.defineProperty(o,"__esModule",{value:!0});var a=e("./IHubProtocol"),c=e("./ILogger"),n=e("./ITransport"),l=e("./Loggers"),u=e("./TextMessageFormat"),e=(r.prototype.parseMessages=function(e,t){if("string"!=typeof e)throw new Error("Invalid input for JSON hub protocol. Expected a string.");if(!e)return[];null===t&&(t=l.NullLogger.instance);for(var o=[],n=0,r=u.TextMessageFormat.parse(e);n<r.length;n++){var s=r[n],i=JSON.parse(s);if("number"!=typeof i.type)throw new Error("Invalid payload.");switch(i.type){case a.MessageType.Invocation:this.isInvocationMessage(i);break;case a.MessageType.StreamItem:this.isStreamItemMessage(i);break;case a.MessageType.Completion:this.isCompletionMessage(i);break;case a.MessageType.Ping:case a.MessageType.Close:break;default:t.log(c.LogLevel.Information,"Unknown message type '"+i.type+"' ignored.");continue}o.push(i)}return o},r.prototype.writeMessage=function(e){return u.TextMessageFormat.write(JSON.stringify(e))},r.prototype.isInvocationMessage=function(e){this.assertNotEmptyString(e.target,"Invalid payload for Invocation message."),void 0!==e.invocationId&&this.assertNotEmptyString(e.invocationId,"Invalid payload for Invocation message.")},r.prototype.isStreamItemMessage=function(e){if(this.assertNotEmptyString(e.invocationId,"Invalid payload for StreamItem message."),void 0===e.item)throw new Error("Invalid payload for StreamItem message.")},r.prototype.isCompletionMessage=function(e){if(e.result&&e.error)throw new Error("Invalid payload for Completion message.");!e.result&&e.error&&this.assertNotEmptyString(e.error,"Invalid payload for Completion message."),this.assertNotEmptyString(e.invocationId,"Invalid payload for Completion message.")},r.prototype.assertNotEmptyString=function(e,t){if("string"!=typeof e||""===e)throw new Error(t)},r);function r(){this.name="json",this.version=1,this.transferFormat=n.TransferFormat.Text}o.JsonHubProtocol=e},{"./IHubProtocol":8,"./ILogger":9,"./ITransport":10,"./Loggers":12,"./TextMessageFormat":15}],12:[function(e,t,o){"use strict";Object.defineProperty(o,"__esModule",{value:!0});var n=(r.prototype.log=function(e,t){},r.instance=new r,r);function r(){}o.NullLogger=n},{}],13:[function(e,t,o){"use strict";var i=this&&this.__awaiter||function(s,i,a,c){return new(a=a||Promise)(function(e,t){function o(e){try{r(c.next(e))}catch(e){t(e)}}function n(e){try{r(c.throw(e))}catch(e){t(e)}}function r(t){t.done?e(t.value):new a(function(e){e(t.value)}).then(o,n)}r((c=c.apply(s,i||[])).next())})},a=this&&this.__generator||function(o,n){var r,s,i,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]},e={next:t(0),throw:t(1),return:t(2)};return"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function(t){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,s&&(i=2&t[0]?s.return:t[0]?s.throw||((i=s.return)&&i.call(s),0):s.next)&&!(i=i.call(s,t[1])).done)return i;switch(s=0,(t=i?[2&t[0],i.value]:t)[0]){case 0:case 1:i=t;break;case 4:return a.label++,{value:t[1],done:!1};case 5:a.label++,s=t[1],t=[0];continue;case 7:t=a.ops.pop(),a.trys.pop();continue;default:if(!(i=0<(i=a.trys).length&&i[i.length-1])&&(6===t[0]||2===t[0])){a=0;continue}if(3===t[0]&&(!i||t[1]>i[0]&&t[1]<i[3])){a.label=t[1];break}if(6===t[0]&&a.label<i[1]){a.label=i[1],i=t;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(t);break}i[2]&&a.ops.pop(),a.trys.pop();continue}t=n.call(o,a)}catch(e){t=[6,e],s=0}finally{r=i=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,e])}}};Object.defineProperty(o,"__esModule",{value:!0});var s=e("./AbortController"),c=e("./Errors"),l=e("./ILogger"),u=e("./ITransport"),p=e("./Utils"),e=(Object.defineProperty(n.prototype,"pollAborted",{get:function(){return this.pollAbort.aborted},enumerable:!0,configurable:!0}),n.prototype.connect=function(r,s){return i(this,void 0,void 0,function(){var t,o,n;return a(this,function(e){switch(e.label){case 0:if(p.Arg.isRequired(r,"url"),p.Arg.isRequired(s,"transferFormat"),p.Arg.isIn(s,u.TransferFormat,"transferFormat"),this.url=r,this.logger.log(l.LogLevel.Trace,"(LongPolling transport) Connecting"),s===u.TransferFormat.Binary&&"string"!=typeof(new XMLHttpRequest).responseType)throw new Error("Binary protocols over XmlHttpRequest not implementing advanced features are not supported.");return t={abortSignal:this.pollAbort.signal,headers:{},timeout:9e4},s===u.TransferFormat.Binary&&(t.responseType="arraybuffer"),[4,this.accessTokenFactory()];case 1:return n=e.sent(),this.updateHeaderToken(t,n),n=r+"&_="+Date.now(),this.logger.log(l.LogLevel.Trace,"(LongPolling transport) polling: "+n),[4,this.httpClient.get(n,t)];case 2:return 200!==(n=e.sent()).statusCode?(this.logger.log(l.LogLevel.Error,"(LongPolling transport) Unexpected response code: "+n.statusCode),o=new c.HttpError(n.statusText,n.statusCode),this.running=!1):this.running=!0,this.poll(this.url,t,o),[2,Promise.resolve()]}})})},n.prototype.updateHeaderToken=function(e,t){t?e.headers.Authorization="Bearer "+t:e.headers.Authorization&&delete e.headers.Authorization},n.prototype.poll=function(n,r,s){return i(this,void 0,void 0,function(){var t,o;return a(this,function(e){switch(e.label){case 0:e.trys.push([0,,8,9]),e.label=1;case 1:return this.running?[4,this.accessTokenFactory()]:[3,7];case 2:t=e.sent(),this.updateHeaderToken(r,t),e.label=3;case 3:return e.trys.push([3,5,,6]),t=n+"&_="+Date.now(),this.logger.log(l.LogLevel.Trace,"(LongPolling transport) polling: "+t),[4,this.httpClient.get(t,r)];case 4:return 204===(o=e.sent()).statusCode?(this.logger.log(l.LogLevel.Information,"(LongPolling transport) Poll terminated by server"),this.running=!1):200!==o.statusCode?(this.logger.log(l.LogLevel.Error,"(LongPolling transport) Unexpected response code: "+o.statusCode),s=new c.HttpError(o.statusText,o.statusCode),this.running=!1):o.content?(this.logger.log(l.LogLevel.Trace,"(LongPolling transport) data received. "+p.getDataDetail(o.content,this.logMessageContent)),this.onreceive&&this.onreceive(o.content)):this.logger.log(l.LogLevel.Trace,"(LongPolling transport) Poll timed out, reissuing."),[3,6];case 5:return o=e.sent(),this.running?o instanceof c.TimeoutError?this.logger.log(l.LogLevel.Trace,"(LongPolling transport) Poll timed out, reissuing."):(s=o,this.running=!1):this.logger.log(l.LogLevel.Trace,"(LongPolling transport) Poll errored after shutdown: "+o.message),[3,6];case 6:return[3,1];case 7:return[3,9];case 8:return this.stopped=!0,this.shutdownTimer&&clearTimeout(this.shutdownTimer),this.onclose&&(this.logger.log(l.LogLevel.Trace,"(LongPolling transport) Firing onclose event. Error: "+(s||"<undefined>")),this.onclose(s)),this.logger.log(l.LogLevel.Trace,"(LongPolling transport) Transport finished."),[7];case 9:return[2]}})})},n.prototype.send=function(t){return i(this,void 0,void 0,function(){return a(this,function(e){return this.running?[2,p.sendMessage(this.logger,"LongPolling",this.httpClient,this.url,this.accessTokenFactory,t,this.logMessageContent)]:[2,Promise.reject(new Error("Cannot send until the transport is connected"))]})})},n.prototype.stop=function(){return i(this,void 0,void 0,function(){var t,o,n=this;return a(this,function(e){switch(e.label){case 0:return e.trys.push([0,,3,4]),this.running=!1,this.logger.log(l.LogLevel.Trace,"(LongPolling transport) sending DELETE request to "+this.url+"."),t={headers:{}},[4,this.accessTokenFactory()];case 1:return o=e.sent(),this.updateHeaderToken(t,o),[4,this.httpClient.delete(this.url,t)];case 2:return e.sent(),this.logger.log(l.LogLevel.Trace,"(LongPolling transport) DELETE request accepted."),[3,4];case 3:return this.stopped||(this.shutdownTimer=setTimeout(function(){n.logger.log(l.LogLevel.Warning,"(LongPolling transport) server did not terminate after DELETE request, canceling poll."),n.pollAbort.abort()},this.shutdownTimeout)),[7];case 4:return[2]}})})},n);function n(e,t,o,n,r){this.httpClient=e,this.accessTokenFactory=t||function(){return null},this.logger=o,this.pollAbort=new s.AbortController,this.logMessageContent=n,this.shutdownTimeout=r||5e3}o.LongPollingTransport=e},{"./AbortController":1,"./Errors":2,"./ILogger":9,"./ITransport":10,"./Utils":16}],14:[function(e,t,o){"use strict";var n=this&&this.__awaiter||function(s,i,a,c){return new(a=a||Promise)(function(e,t){function o(e){try{r(c.next(e))}catch(e){t(e)}}function n(e){try{r(c.throw(e))}catch(e){t(e)}}function r(t){t.done?e(t.value):new a(function(e){e(t.value)}).then(o,n)}r((c=c.apply(s,i||[])).next())})},a=this&&this.__generator||function(o,n){var r,s,i,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]},e={next:t(0),throw:t(1),return:t(2)};return"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function(t){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,s&&(i=2&t[0]?s.return:t[0]?s.throw||((i=s.return)&&i.call(s),0):s.next)&&!(i=i.call(s,t[1])).done)return i;switch(s=0,(t=i?[2&t[0],i.value]:t)[0]){case 0:case 1:i=t;break;case 4:return a.label++,{value:t[1],done:!1};case 5:a.label++,s=t[1],t=[0];continue;case 7:t=a.ops.pop(),a.trys.pop();continue;default:if(!(i=0<(i=a.trys).length&&i[i.length-1])&&(6===t[0]||2===t[0])){a=0;continue}if(3===t[0]&&(!i||t[1]>i[0]&&t[1]<i[3])){a.label=t[1];break}if(6===t[0]&&a.label<i[1]){a.label=i[1],i=t;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(t);break}i[2]&&a.ops.pop(),a.trys.pop();continue}t=n.call(o,a)}catch(e){t=[6,e],s=0}finally{r=i=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,e])}}};Object.defineProperty(o,"__esModule",{value:!0});var c=e("./ILogger"),l=e("./ITransport"),u=e("./Utils"),e=(r.prototype.connect=function(s,i){return n(this,void 0,void 0,function(){var t,r=this;return a(this,function(e){switch(e.label){case 0:if(u.Arg.isRequired(s,"url"),u.Arg.isRequired(i,"transferFormat"),u.Arg.isIn(i,l.TransferFormat,"transferFormat"),"undefined"==typeof EventSource)throw new Error("'EventSource' is not supported in your environment.");return this.logger.log(c.LogLevel.Trace,"(SSE transport) Connecting"),[4,this.accessTokenFactory()];case 1:return(t=e.sent())&&(s+=(s.indexOf("?")<0?"?":"&")+"access_token="+encodeURIComponent(t)),this.url=s,[2,new Promise(function(e,t){var o=!1;i!==l.TransferFormat.Text&&t(new Error("The Server-Sent Events transport only supports the 'Text' transfer format"));var n=new EventSource(s,{withCredentials:!0});try{n.onmessage=function(e){if(r.onreceive)try{r.logger.log(c.LogLevel.Trace,"(SSE transport) data received. "+u.getDataDetail(e.data,r.logMessageContent)+"."),r.onreceive(e.data)}catch(e){return void(r.onclose&&r.onclose(e))}},n.onerror=function(e){e=new Error(e.message||"Error occurred");o?r.close(e):t(e)},n.onopen=function(){r.logger.log(c.LogLevel.Information,"SSE connected to "+r.url),r.eventSource=n,o=!0,e()}}catch(e){return Promise.reject(e)}})]}})})},r.prototype.send=function(t){return n(this,void 0,void 0,function(){return a(this,function(e){return this.eventSource?[2,u.sendMessage(this.logger,"SSE",this.httpClient,this.url,this.accessTokenFactory,t,this.logMessageContent)]:[2,Promise.reject(new Error("Cannot send until the transport is connected"))]})})},r.prototype.stop=function(){return this.close(),Promise.resolve()},r.prototype.close=function(e){this.eventSource&&(this.eventSource.close(),this.eventSource=null,this.onclose&&this.onclose(e))},r);function r(e,t,o,n){this.httpClient=e,this.accessTokenFactory=t||function(){return null},this.logger=o,this.logMessageContent=n}o.ServerSentEventsTransport=e},{"./ILogger":9,"./ITransport":10,"./Utils":16}],15:[function(e,t,o){"use strict";Object.defineProperty(o,"__esModule",{value:!0});var n=(r.write=function(e){return""+e+r.RecordSeparator},r.parse=function(e){if(e[e.length-1]!==r.RecordSeparator)throw new Error("Message is incomplete.");e=e.split(r.RecordSeparator);return e.pop(),e},r.RecordSeparatorCode=30,r.RecordSeparator=String.fromCharCode(r.RecordSeparatorCode),r);function r(){}o.TextMessageFormat=n},{}],16:[function(e,t,o){"use strict";var n=this&&this.__awaiter||function(s,i,a,c){return new(a=a||Promise)(function(e,t){function o(e){try{r(c.next(e))}catch(e){t(e)}}function n(e){try{r(c.throw(e))}catch(e){t(e)}}function r(t){t.done?e(t.value):new a(function(e){e(t.value)}).then(o,n)}r((c=c.apply(s,i||[])).next())})},p=this&&this.__generator||function(o,n){var r,s,i,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]},e={next:t(0),throw:t(1),return:t(2)};return"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function(t){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,s&&(i=2&t[0]?s.return:t[0]?s.throw||((i=s.return)&&i.call(s),0):s.next)&&!(i=i.call(s,t[1])).done)return i;switch(s=0,(t=i?[2&t[0],i.value]:t)[0]){case 0:case 1:i=t;break;case 4:return a.label++,{value:t[1],done:!1};case 5:a.label++,s=t[1],t=[0];continue;case 7:t=a.ops.pop(),a.trys.pop();continue;default:if(!(i=0<(i=a.trys).length&&i[i.length-1])&&(6===t[0]||2===t[0])){a=0;continue}if(3===t[0]&&(!i||t[1]>i[0]&&t[1]<i[3])){a.label=t[1];break}if(6===t[0]&&a.label<i[1]){a.label=i[1],i=t;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(t);break}i[2]&&a.ops.pop(),a.trys.pop();continue}t=n.call(o,a)}catch(e){t=[6,e],s=0}finally{r=i=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,e])}}};Object.defineProperty(o,"__esModule",{value:!0});var h=e("./ILogger"),r=e("./Loggers"),e=(s.isRequired=function(e,t){if(null==e)throw new Error("The '"+t+"' argument is required.")},s.isIn=function(e,t,o){if(!(e in t))throw new Error("Unknown "+o+" value: "+e+".")},s);function s(){}function g(e,t){var o=null;return d(e)?(o="Binary data of length "+e.byteLength,t&&(o+=". Content: '"+i(e)+"'")):"string"==typeof e&&(o="String data of length "+e.length,t&&(o+=". Content: '"+e+"'.")),o}function i(e){var e=new Uint8Array(e),t="";return e.forEach(function(e){t+="0x"+(e<16?"0":"")+e.toString(16)+" "}),t.substr(0,t.length-1)}o.Arg=e,o.getDataDetail=g,o.formatArrayBuffer=i,o.sendMessage=function(r,s,i,a,c,l,u){return n(this,void 0,void 0,function(){var t,o,n;return p(this,function(e){switch(e.label){case 0:return[4,c()];case 1:return(o=e.sent())&&((n={}).Authorization="Bearer "+o,t=n),r.log(h.LogLevel.Trace,"("+s+" transport) sending data. "+g(l,u)+"."),[4,i.post(a,{content:l,headers:t})];case 2:return n=e.sent(),r.log(h.LogLevel.Trace,"("+s+" transport) request complete. Response status: "+n.statusCode+"."),[2]}})})},o.createLogger=function(e){return void 0===e?new u(h.LogLevel.Information):null===e?r.NullLogger.instance:e.log?e:new u(e)};a.prototype.next=function(e){for(var t=0,o=this.observers;t<o.length;t++)o[t].next(e)},a.prototype.error=function(e){for(var t=0,o=this.observers;t<o.length;t++){var n=o[t];n.error&&n.error(e)}},a.prototype.complete=function(){for(var e=0,t=this.observers;e<t.length;e++){var o=t[e];o.complete&&o.complete()}},a.prototype.subscribe=function(e){return this.observers.push(e),new c(this,e)},e=a;function a(e){this.observers=[],this.cancelCallback=e}o.Subject=e;var c=(l.prototype.dispose=function(){var e=this.subject.observers.indexOf(this.observer);-1<e&&this.subject.observers.splice(e,1),0===this.subject.observers.length&&this.subject.cancelCallback().catch(function(e){})},l);function l(e,t){this.subject=e,this.observer=t}o.SubjectSubscription=c;var u=(f.prototype.log=function(e,t){if(e>=this.minimumLogLevel)switch(e){case h.LogLevel.Critical:case h.LogLevel.Error:console.error(h.LogLevel[e]+": "+t);break;case h.LogLevel.Warning:console.warn(h.LogLevel[e]+": "+t);break;case h.LogLevel.Information:console.info(h.LogLevel[e]+": "+t);break;default:console.log(h.LogLevel[e]+": "+t)}},f);function f(e){this.minimumLogLevel=e}function d(e){return e&&"undefined"!=typeof ArrayBuffer&&(e instanceof ArrayBuffer||e.constructor&&"ArrayBuffer"===e.constructor.name)}o.ConsoleLogger=u,o.isArrayBuffer=d},{"./ILogger":9,"./Loggers":12}],17:[function(e,t,o){"use strict";var n=this&&this.__awaiter||function(s,i,a,c){return new(a=a||Promise)(function(e,t){function o(e){try{r(c.next(e))}catch(e){t(e)}}function n(e){try{r(c.throw(e))}catch(e){t(e)}}function r(t){t.done?e(t.value):new a(function(e){e(t.value)}).then(o,n)}r((c=c.apply(s,i||[])).next())})},a=this&&this.__generator||function(o,n){var r,s,i,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]},e={next:t(0),throw:t(1),return:t(2)};return"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function(t){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,s&&(i=2&t[0]?s.return:t[0]?s.throw||((i=s.return)&&i.call(s),0):s.next)&&!(i=i.call(s,t[1])).done)return i;switch(s=0,(t=i?[2&t[0],i.value]:t)[0]){case 0:case 1:i=t;break;case 4:return a.label++,{value:t[1],done:!1};case 5:a.label++,s=t[1],t=[0];continue;case 7:t=a.ops.pop(),a.trys.pop();continue;default:if(!(i=0<(i=a.trys).length&&i[i.length-1])&&(6===t[0]||2===t[0])){a=0;continue}if(3===t[0]&&(!i||t[1]>i[0]&&t[1]<i[3])){a.label=t[1];break}if(6===t[0]&&a.label<i[1]){a.label=i[1],i=t;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(t);break}i[2]&&a.ops.pop(),a.trys.pop();continue}t=n.call(o,a)}catch(e){t=[6,e],s=0}finally{r=i=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,e])}}};Object.defineProperty(o,"__esModule",{value:!0});var c=e("./ILogger"),l=e("./ITransport"),u=e("./Utils"),e=(r.prototype.connect=function(s,i){return n(this,void 0,void 0,function(){var t,r=this;return a(this,function(e){switch(e.label){case 0:if(u.Arg.isRequired(s,"url"),u.Arg.isRequired(i,"transferFormat"),u.Arg.isIn(i,l.TransferFormat,"transferFormat"),"undefined"==typeof WebSocket)throw new Error("'WebSocket' is not supported in your environment.");return this.logger.log(c.LogLevel.Trace,"(WebSockets transport) Connecting"),[4,this.accessTokenFactory()];case 1:return(t=e.sent())&&(s+=(s.indexOf("?")<0?"?":"&")+"access_token="+encodeURIComponent(t)),[2,new Promise(function(t,o){s=s.replace(/^http/,"ws");var n=new WebSocket(s);i===l.TransferFormat.Binary&&(n.binaryType="arraybuffer"),n.onopen=function(e){r.logger.log(c.LogLevel.Information,"WebSocket connected to "+s),r.webSocket=n,t()},n.onerror=function(e){o(e.error)},n.onmessage=function(e){r.logger.log(c.LogLevel.Trace,"(WebSockets transport) data received. "+u.getDataDetail(e.data,r.logMessageContent)+"."),r.onreceive&&r.onreceive(e.data)},n.onclose=function(e){r.logger.log(c.LogLevel.Trace,"(WebSockets transport) socket closed."),r.onclose&&(!1===e.wasClean||1e3!==e.code?r.onclose(new Error("Websocket closed with status code: "+e.code+" ("+e.reason+")")):r.onclose())}})]}})})},r.prototype.send=function(e){return this.webSocket&&this.webSocket.readyState===WebSocket.OPEN?(this.logger.log(c.LogLevel.Trace,"(WebSockets transport) sending data. "+u.getDataDetail(e,this.logMessageContent)+"."),this.webSocket.send(e),Promise.resolve()):Promise.reject("WebSocket is not in the OPEN state")},r.prototype.stop=function(){return this.webSocket&&(this.webSocket.close(),this.webSocket=null),Promise.resolve()},r);function r(e,t,o){this.logger=t,this.accessTokenFactory=e||function(){return null},this.logMessageContent=o}o.WebSocketTransport=e},{"./ILogger":9,"./ITransport":10,"./Utils":16}],18:[function(e,t,o){"use strict";Object.defineProperty(o,"__esModule",{value:!0}),o.VERSION="1.0.27";var n=e("./Errors");o.HttpError=n.HttpError,o.TimeoutError=n.TimeoutError;n=e("./HttpClient");o.DefaultHttpClient=n.DefaultHttpClient,o.HttpClient=n.HttpClient,o.HttpResponse=n.HttpResponse;n=e("./HubConnection");o.HubConnection=n.HubConnection;n=e("./HubConnectionBuilder");o.HubConnectionBuilder=n.HubConnectionBuilder;n=e("./IHubProtocol");o.MessageType=n.MessageType;n=e("./ILogger");o.LogLevel=n.LogLevel;n=e("./ITransport");o.HttpTransportType=n.HttpTransportType,o.TransferFormat=n.TransferFormat;n=e("./Loggers");o.NullLogger=n.NullLogger;e=e("./JsonHubProtocol");o.JsonHubProtocol=e.JsonHubProtocol},{"./Errors":2,"./HttpClient":4,"./HubConnection":6,"./HubConnectionBuilder":7,"./IHubProtocol":8,"./ILogger":9,"./ITransport":10,"./JsonHubProtocol":11,"./Loggers":12}],19:[function(e,t,o){"use strict";Object.defineProperty(o,"__esModule",{value:!0}),o.ApiModule=o.get=o.extend=void 0,o.extend=function(e,t){window.__iat_api||window.__iat_api||(window.__iat_api={}),window.__iat_api[e.toString()]=t},o.get=function(e){return window.__iat_api[e.toString()]},(o=o.ApiModule||(o.ApiModule={})).RealtimeProvider="r",o.APS="APS",o.DFP="DFP"},{}],20:[function(e,t,o){"use strict";Object.defineProperty(o,"__esModule",{value:!0}),o.SignalRProvider=void 0;var n=e("@aspnet/signalr"),e=(r.prototype.isConnected=function(){return this.connected},r.prototype.connect=function(t){var o=this;t&&t.toLowerCase().startsWith("https://")&&(this.client=(new n.HubConnectionBuilder).withUrl(t,{logger:n.LogLevel.None}).build(),this.client.onclose(function(e){o.log("Connection closed "+(e||"")),o.connected=!1,o.onDisconnect&&o.onDisconnect(),o.mustReconnect&&o.connect(t)}),this.client.on("ReceiveMessage",function(e){o.log(e),o.onReceiveMessage&&o.onReceiveMessage(e)}),this.mustReconnect=!0,this.log("Connecting..."),this.client.start().then(function(){o.log("Connected"),o.connected=!0,o.connectAttempt=0,o.onConnect&&o.onConnect()}).catch(function(e){o.log("Error on connect: "+e),o.connectAttempt<o.connectMaxRetries?setTimeout(function(){return o.connect(t)},2e3):o.onFailedConnect&&o.onFailedConnect(),o.connectAttempt++}))},r.prototype.disconnect=function(){var t=this;this.client&&(this.mustReconnect=!1,this.client.stop().then(function(){t.log("Disconnected...")}).catch(function(e){t.log("Error on disconnect: "+e)}))},r.prototype.send=function(e){var n=this;return this.log("Sent: "+e),new Promise(function(t,o){try{n.client.send("SendMessage",e).then(function(e){return t()}).catch(function(e){return o(e)})}catch(e){o(e.message)}})},r.prototype.log=function(e){this.onLogMessage&&this.onLogMessage(e)},r);function r(){this.connectMaxRetries=2,this.connected=!1,this.mustReconnect=!1,this.connectAttempt=0}o.SignalRProvider=e},{"@aspnet/signalr":18}],21:[function(e,t,o){"use strict";Object.defineProperty(o,"__esModule",{value:!0});var n=e("./modules/API"),r=e("./modules/realtime-messaging/SignalRProvider");function s(){n.extend(n.ApiModule.RealtimeProvider,this)}new(s.prototype.createInstance=function(){return new r.SignalRProvider},s)},{"./modules/API":19,"./modules/realtime-messaging/SignalRProvider":20}]},{},[21]);